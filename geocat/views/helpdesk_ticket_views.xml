<?xml version="1.0"?>
<odoo>

    <record id="helpdesk_ticket_view_activity" model="ir.ui.view">
        <field name="name">geocat.ticket.activity</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_activity"/>
        <field name="arch" type="xml">
            <field name="ticket_ref" position="replace">
                <field name="display_ref" />
            </field>
        </field>
    </record>

    <record id="helpdesk_tickets_view_search" model="ir.ui.view">
        <field name="name">geocat.ticket.search</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_tickets_view_search"/>
        <field name="arch" type="xml">
            <field name="name" position="attributes">
                <attribute name="filter_domain">['|', ('name', 'ilike', self), ('ticket_ref', 'ilike', self), ('import_ref', 'ilike', self)]</attribute>
            </field>
            <field name="tag_ids" position="after">
                <field name="applies_to"/>
            </field>
            <filter name="urgent_priority" position="attributes">
                <attribute name="string">Immediate (P1)</attribute>
            </filter>
            <filter name="high_priority" position="attributes">
                <attribute name="string">Urgent (P2)</attribute>
            </filter>
            <filter name="medium_priority" position="attributes">
                <attribute name="string">Normal (P3)</attribute>
            </filter>
            <filter name="low_priority" position="attributes">
                <attribute name="string">Low (S/X)</attribute>
            </filter>
            <field name="priority" position="before">
                <field name="classification"/>
            </field>
            <xpath expr="//group/filter[@name='state']" position="replace">
                <filter string="Blocked State" name="state" context="{'group_by': 'blocked_state'}"/>
            </xpath>
        </field>
    </record>

    <record id="helpdesk_ticket_view_search_analysis_closed" model="ir.ui.view">
        <field name="name">geocat.ticket.search</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_search_analysis_closed"/>
        <field name="arch" type="xml">
            <field name="user_id" position="after">
                <field name="priority" invisible="1"/>
            </field>
            <filter name="unassigned" position="after">
                <separator/>
                <filter string="Priority Tickets" name="priority_tickets" domain="[('priority', 'in', ('1', '2', '3'))]"/>
                <filter string="Other Tickets" name="other_tickets" domain="[('priority', 'not in', ('1', '2', '3'))]"/>
            </filter>
        </field>
    </record>

    <record id="helpdesk_tickets_view_tree_geocat" model="ir.ui.view">
        <field name="name">geocat.ticket.list</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_tickets_view_tree"/>
        <field name="arch" type="xml">
            <field name="ticket_ref" position="replace">
                <field name="display_ref" string="ID" readonly="1" optional="show"/>
            </field>
            <field name="priority" position="after">
                <field name="classification" optional="show"/>
            </field>
            <field name="activity_ids" position="attributes">
                <attribute name="optional">hide</attribute>
            </field>
            <field name="rating_avg_text" position="replace"/>
            <field name="kanban_state" position="replace"/>
            <field name="stage_id" position="after">
                <field name="all_blocked_states_json" column_invisible="True"/>
                <field name="blocked_state" string="Status" widget="many2one_state_selection" options="{'states_field': 'all_blocked_states_json', 'hide_label': False}" groups="base.group_user"/>
            </field>
        </field>
    </record>

    <record id="helpdesk_ticket_view_kanban" model="ir.ui.view">
        <field name="name">helpdesk.ticket.kanban</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_kanban"/>
        <field name="arch" type="xml">
            <progressbar field="kanban_state" position="replace"/> <!-- TODO: Create custom progress bar that can deal with the many2one field? -->
            <xpath expr="//t[@t-name='card']//field[@name='ticket_ref']/.." position="replace">
                <div class="fw-bold fs-5">
                    <field name="name"/> (#<field name="display_ref"/>)
                </div>
            </xpath>
            <xpath expr="//t[@t-name='card']//footer//field[@name='kanban_state']" position="replace">
                <field name="all_blocked_states_json" invisible="True"/>
                <field name="blocked_state" invisible="not blocked_state and not all_blocked_states_json" widget="many2one_state_selection" options="{'states_field': 'all_blocked_states_json'}" class="ms-1" groups="base.group_user"/>
            </xpath>
        </field>
    </record>

    <record id="helpdesk_ticket_view_form" model="ir.ui.view">
        <field name="name">geocat.ticket.form</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_form"/>
        <field name="arch" type="xml">
            <field name="priority" position="before">
                <field name="classification" readonly="0" required="1"/>
            </field>
            <field name="tag_ids" position="after">
                <field name="applies_to"/>
            </field>
            <field name="kanban_state" position="replace">
                <field name="all_blocked_states_json" invisible="True"/>
                <field name="blocked_state" invisible="not blocked_state and not all_blocked_states_json" widget="many2one_state_selection" options="{'states_field': 'all_blocked_states_json'}" readonly="1" groups="base.group_user"/>
            </field>
            <field name="email_cc" position="after">
                <field name="blocked_state" groups="base.group_user" string="Status" widget="many2one_state_selection" options="{'states_field': 'all_blocked_states_json', 'hide_label': False}"/>
                <field name="import_ref" string="Legacy #" readonly="1" invisible="not import_ref"/>
            </field>
        </field>
    </record>

    <record id="helpdesk_ticket_view_search_analysis" model="ir.ui.view">
        <field name="name">geocat.ticket.search</field>
        <field name="model">helpdesk.ticket</field>
        <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_search_analysis"/>
        <field name="arch" type="xml">
            <filter name="unassigned" position="after">
                <separator/>
                <filter string="Priority Tickets" name="priority_tickets" domain="[('priority', 'in', ('1', '2', '3'))]"/>
                <filter string="Other Tickets" name="other_tickets" domain="[('priority', 'not in', ('1', '2', '3'))]"/>
            </filter>
        </field>
    </record>

</odoo>
